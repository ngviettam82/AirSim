cmake_minimum_required(VERSION 2.8 FATAL_ERROR)

project(GazeboDrone)

set(AIRSIM_ROOT ..)

if(NOT CMAKE_CXX_STANDARD)
  set(CMAKE_CXX_STANDARD 11)
endif()

find_package(gazebo REQUIRED)

include_directories(
    ${GAZEBO_INCLUDE_DIRS}
    ${AIRSIM_ROOT}/AirLib/deps/eigen3
    ${AIRSIM_ROOT}/AirLib/deps/rpclib/include
    ${AIRSIM_ROOT}/AirLib/include
)

link_directories(
    ${GAZEBO_LIBRARY_DIRS}
    ../../build_release/output/lib
)

list(APPEND CMAKE_CXX_FLAGS "${GAZEBO_CXX_FLAGS}")

add_executable(${PROJECT_NAME} src/main.cpp)

target_link_libraries(
    ${PROJECT_NAME} 
    ${GAZEBO_LIBRARIES}
    pthread
    AirLib
    rpc
 tbb)


# Optionally build the Ignition / gz (new Gazebo) variant. This attempts to find
# a matching pkg-config package for gz/ignition transport (package name may
# differ by distribution). If found, we build `GazeboDrone_gz` from
# `src/main_gz.cpp`.
option(BUILD_GZ "Build Gazebo (gz) bridge" ON)
if(BUILD_GZ)
    find_package(PkgConfig QUIET)
    if(PKG_CONFIG_FOUND)
        set(_pkg_names gz-transport gz-transport8 gz-transport9 gz-transport13 ignition-transport3 ignition-transport4 ignition-transport5 ignition-transport6 ignition-transport7)
        set(_found_pkg "")
        foreach(_pkg ${_pkg_names})
            pkg_check_modules(_GZ ${_pkg} QUIET)
            if(_GZ_FOUND)
                set(_found_pkg ${_pkg})
                break()
            endif()
        endforeach()

        if(_found_pkg STREQUAL "")
            message(WARNING "Could not find a gz/ignition transport pkg-config package. Skipping build of GazeboDrone_gz. If you want to build it, install the dev packages for your gz/ignition release and reconfigure CMake, or set BUILD_GZ=OFF.")
        else()
            message(STATUS "Found gz transport package: ${_found_pkg}")
            include_directories(${_GZ_INCLUDE_DIRS})
            link_directories(${_GZ_LIBRARY_DIRS})

                    add_executable(GazeboDrone_gz src/main_gz.cpp)
                    # gz transport headers (gz 13) require C++17
                    set_target_properties(GazeboDrone_gz PROPERTIES
                        CXX_STANDARD 17
                        CXX_STANDARD_REQUIRED ON
                    )
                    target_link_libraries(GazeboDrone_gz ${_GZ_LIBRARIES} pthread AirLib rpc tbb)
        endif()
    else()
        message(WARNING "pkg-config not found; cannot detect gz transport package. Skipping build of GazeboDrone_gz.")
    endif()
endif()

